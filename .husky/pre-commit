#!/bin/sh

# Format only staged files that can be formatted
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(ts|tsx|js|jsx|json|yml|yaml)$' | sed 's| |\\ |g')
if [ -n "$STAGED_FILES" ]; then
  prettier --write $STAGED_FILES || true
  git add $STAGED_FILES
fi

# Lint only staged TypeScript/JavaScript files
TS_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(ts|tsx|js|jsx)$' | sed 's| |\\ |g')
if [ -n "$TS_FILES" ]; then
  biome check $TS_FILES || true
fi

git update-index --again